data:
  params:
    num_workers: 4
    pin_memory: true
    train:
      target: calo_ldm.data.CaloHDF5
      params:
        load_partial: 10
        file_path: C:\programming\caloVARproject\calo3\dataset_3_1.hdf5
        do_rotations: true
        do_inversions: true
    validation:
      target: calo_ldm.data.CaloHDF5
      params:
        load_partial: 5000
        file_path: C:\programming\caloVARproject\calo3\dataset_3_3.hdf5
    batch_size: 256
  target: calo_ldm.data.DataModuleFromConfig
model:
  base_learning_rate: 1.0e-04
  monitor: val/rec_loss
  target: calo_ldm.models.VQModel
  params:
    dataset_name: '3'
    do_metric: true
    do_more_metric: true
    do_R_metric: null
    metric_evts: 10000
    record_freq: 20
    embed_dim: 256
    n_embed: 1024
    cond_dim: 1
    z_pad:
    - 4
    - 8
    z_padding_strategy: internal
    log_scale_params:
    - 0
    - 40000
    - 10
    reco_normalization: R
    disc_normalization: U
    # Multi-scale quantization parameters
    use_multiscale_quant: true
    v_patch_nums: [1, 2, 3, 4, 5, 6, 9, 13, 18, 26]
    quant_resi: 0.0
    share_quant_resi: 1
    default_qresi_counts: 0
    # VQ-VAE EMA and entropy loss parameters
    vq_use_ema: true
    vq_ema_decay: 0.99
    vq_use_entropy_loss: false
    vq_entropy_loss_weight: 0.1
    vq_entropy_temperature: 1.0
    vq_use_codebook_restart: false
    vq_restart_threshold: 1.0
    codebook_restart_freq: 1000
    encoder_config:
      target: calo_ldm.models.Encoder
      params:
        ch_in: 18
        ch_out: 256
        conv_spec:
        - 'cconv : k33 :     : c32'
        - 'resnet:32'
        - 'cconv : k33 :     : c32'
        - 'resnet:32'
        - 'fftd  : 12 : 2'
        - 'cconv : k33 : s21  : c64'
        - 'resnet:64'
        - 'cconv : k33 :  p   : c64'
        - 'resnet:64'
        - 'fftd  : 8 : 2'
        - 'cconv : k33 :  p  : c128'
        - 'resnet:128'
        - 'attn'
        - 'cconv : k33 :  p  : c128'
        - 'resnet:128'
        - 'fftd  : 4 : 2'
        - 'cconv : k33 :     : c256'
        - 'resnet:256'
        - 'attn'
        cond_dim: 1
        log_scale_params:
        - 0
        - 40000
        - 10
        z_pad:
        - 4
        - 8
        z_padding_strategy: internal
    decoder_config:
      target: calo_ldm.models.DecoderMH
      params:
        ch_in: 256
        ch_out: 18
        conv_spec:
        - 'cconvT : k33 :     : c128'
        - 'resnet:128'
        - 'attn'
        - 'ffti  : 4 : 2'
        - 'cconvT : k33 :  p  : c128'
        - 'resnet:128'
        - 'attn'
        - 'cconvT : k33 :  p  : c64'
        - 'resnet:64'
        - 'ffti  : 8 : 2'
        - 'cconvT : k33 :  p  : c64'
        - 'resnet:64'
        - 'cconvT : k33 : s21 : c32'
        - 'resnet:32'
        - 'ffti  : 12 : 2'
        - 'cconvT : k33 :     : c32'
        - 'resnet:32'
        - 'cconvT : k33 :     : c32'
        output_activation: voxel_relu_expm1_max
        cond_dim: 1
        z_pad:
        - 4
        - 8
        z_padding_strategy: internal
        learn_R: false
        layer_seg:
        - 1
        - 1
        - 1
        - 1
        - 1
        - 1
        - 1
        - 1
        - 1
        - 1
        - 1
        - 1
        - 1
        - 1
        - 1
        - 1
        - 1
        - 1
        - 1
        - 1
        - 1
        - 1
        - 1
        - 1
        - 1
        - 1
        - 1
        - 1
        - 1
        - 1
        - 1
        - 1
        - 1
        - 1
        - 1
        - 1
        - 1
        - 1
        - 1
        - 1
        - 1
        - 1
        - 1
        - 1
        - 1
        layer_seg_dim: -2
    loss_config:
      target: calo_ldm.losses.CombinedLoss
      params:
        pixel_power: 2
        pixel_weight: 1
        # ===== Calo-eval aligned high-level feature (HLF) losses =====
        # Enables physics grids matching calo_eval XML binning exactly
        use_calo_eval_physics: true
        # EC (energy center) and Width losses for eta/phi
        ec_weight: 0.0001
        width_weight: 0.0001
        # Radial EC and Width losses (new, matching calo_eval)
        ec_r_weight: 0.0001
        width_r_weight: 0.0001
        # Per-layer energy fraction loss
        e_layer_weight: 0.0001
        # Sparsity matching loss
        sparsity_weight: 0.0001
        overflow_penalty_weight: 0.001
        disc_conditional: false
        disc_in_channels: 9
        disc_start: 500
        disc_weight: 0.8
        codebook_weight: 1.0
        perceptual_weight: 0
        R1_weight: 5
        R2_weight: 0
        disc_config:
          target: calo_ldm.models.Discriminator
          params:
            use_spectral_norm: false
            pooling: null
            cond_dim: 1
            ch_in: 18
            conv_spec:
            - 'cconv : k33 :     : c32'
            - 'cconv : k33 : s21 : c64'
            - 'fftd : 18'
            - 'cconv : k33 :     : c64'
            - 'cconv : k33 : s21 : c128'
            - 'fftd : 16'
            - 'cconv : k33 :     : c128'
            - 'fftd : 8'
            - 'cconv : k33 :     : c256'
            log_scale_params:
            - 0
            - 40000
            - 10
        perceptual_config: null
        cond_dim: 1
        n_embed: 1024
        log_scale_params:
        - 0
        - 40000
        - 10
        disc_normalization: U
        reco_normalization: R
        unpad_z: null
        dataset_name: '3'
        learn_R: false
